[SERVICE]
    Flush        1
    Daemon       Off
    Log_Level    info
    Parsers_File parsers.conf
    HTTP_Server  On
    HTTP_Listen  0.0.0.0
    HTTP_Port    2020
    Health_Check On

# Application Audit Logs
[INPUT]
    Name              tail
    Path              /var/log/gameforge/audit/*.log
    Parser            gameforge_audit
    Tag               audit.gameforge.application
    Refresh_Interval  5
    Rotate_Wait       30
    Skip_Long_Lines   On
    DB                /var/log/flb_gameforge_audit.db

# System Audit Logs
[INPUT]
    Name              tail
    Path              /var/log/audit/audit.log
    Parser            linux_audit
    Tag               audit.system.linux
    Refresh_Interval  5
    Skip_Long_Lines   On
    DB                /var/log/flb_system_audit.db

# Docker Container Audit Logs
[INPUT]
    Name              tail
    Path              /var/lib/docker/containers/*/*.log
    Parser            docker_audit
    Tag               audit.docker.containers
    Refresh_Interval  5
    Skip_Long_Lines   On
    DB                /var/log/flb_docker_audit.db

# Kubernetes Audit Logs
[INPUT]
    Name              tail
    Path              /var/log/kubernetes/audit/*.log
    Parser            k8s_audit
    Tag               audit.kubernetes.api
    Refresh_Interval  5
    Skip_Long_Lines   On
    DB                /var/log/flb_k8s_audit.db

# HTTP Access Logs for Audit Trail
[INPUT]
    Name              tail
    Path              /var/log/nginx/access.log
    Parser            nginx_audit
    Tag               audit.web.access
    Refresh_Interval  5
    Skip_Long_Lines   On
    DB                /var/log/flb_nginx_audit.db

# Security Event Logs
[INPUT]
    Name              tail
    Path              /var/log/security/*.log
    Parser            security_audit
    Tag               audit.security.events
    Refresh_Interval  5
    Skip_Long_Lines   On
    DB                /var/log/flb_security_audit.db

# Database Audit Logs
[INPUT]
    Name              tail
    Path              /var/log/postgresql/postgresql-audit.log
    Parser            postgres_audit
    Tag               audit.database.postgres
    Refresh_Interval  5
    Skip_Long_Lines   On
    DB                /var/log/flb_postgres_audit.db

# Enrich logs with metadata
[FILTER]
    Name                modify
    Match               audit.*
    Add                 audit_version 1.0
    Add                 environment ${ENVIRONMENT:-production}
    Add                 service_name gameforge
    Add                 datacenter ${DATACENTER:-primary}
    Add                 compliance_required true

# Add hostname and IP information
[FILTER]
    Name                record_modifier
    Match               audit.*
    Record              hostname ${HOSTNAME}
    Record              host_ip ${HOST_IP}
    Record              audit_collector fluent-bit

# Parse and validate audit events
[FILTER]
    Name                parser
    Match               audit.gameforge.application
    Key_Name            message
    Parser              gameforge_audit_parser
    Reserve_Data        On

# Compliance tagging
[FILTER]
    Name                modify
    Match               audit.*
    Condition           Key_value_matches log_level ERROR
    Add                 compliance_violation true
    Add                 severity high

[FILTER]
    Name                modify
    Match               audit.*
    Condition           Key_value_matches event_type authentication_failed
    Add                 security_event true
    Add                 priority critical

# Output to Kafka for real-time processing
[OUTPUT]
    Name              kafka
    Match             audit.*
    Brokers           kafka-audit:29092
    Topics            audit-events
    Timestamp_Key     @timestamp
    Retry_Limit       false
    rdkafka.queue.buffering.max.ms 5
    rdkafka.message.max.bytes 2000000

# Output to Elasticsearch for storage and analysis
[OUTPUT]
    Name              es
    Match             audit.*
    Host              ${FLUENT_ELASTICSEARCH_HOST}
    Port              ${FLUENT_ELASTICSEARCH_PORT}
    HTTP_User         ${FLUENT_ELASTICSEARCH_USER}
    HTTP_Passwd       ${FLUENT_ELASTICSEARCH_PASSWORD}
    Index             gameforge-audit
    Type              _doc
    Time_Key          @timestamp
    Time_Key_Format   %Y-%m-%dT%H:%M:%S.%L%z
    Time_Key_Nanos    On
    Include_Tag_Key   On
    Tag_Key           _tag
    Logstash_Format   On
    Logstash_Prefix   gameforge-audit
    Logstash_DateFormat %Y.%m.%d
    Generate_ID       On
    Retry_Limit       false
    Replace_Dots      On
    Trace_Error       On

# Output to file for backup and compliance
[OUTPUT]
    Name              file
    Match             audit.*
    Path              /var/log/audit-backup/
    File              audit-backup.log
    Format            json_lines
