# GameForge AI System - Alert Rules for Prometheus
# Production monitoring and alerting

groups:
  - name: gameforge_ai_alerts
    rules:
      # High CPU Usage
      - alert: HighCPUUsage
        expr: cpu_usage_percent > 80
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High CPU usage detected"
          description: "CPU usage is above 80% for more than 5 minutes"

      # High GPU Usage
      - alert: HighGPUUsage
        expr: gpu_utilization_percent > 95
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "High GPU usage detected"
          description: "GPU utilization is above 95% for more than 2 minutes"

      # High Memory Usage
      - alert: HighMemoryUsage
        expr: memory_usage_percent > 85
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High memory usage detected"
          description: "Memory usage is above 85% for more than 5 minutes"

      # Service Down
      - alert: GameForgeServiceDown
        expr: up{job="gameforge-ai"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "GameForge AI service is down"
          description: "GameForge AI service has been down for more than 1 minute"

      # High Response Time
      - alert: HighResponseTime
        expr: http_request_duration_seconds{quantile="0.95"} > 5
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High response time detected"
          description: "95th percentile response time is above 5 seconds"

      # GPU Memory Low
      - alert: LowGPUMemory
        expr: gpu_memory_free_bytes / gpu_memory_total_bytes < 0.1
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "Low GPU memory available"
          description: "GPU memory usage is above 90%"

      # Queue Backlog
      - alert: HighQueueBacklog
        expr: redis_queue_length > 100
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High queue backlog detected"
          description: "Redis queue has more than 100 pending jobs"

      # Failed Generations
      - alert: HighFailureRate
        expr: rate(generation_failures_total[5m]) > 0.1
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "High generation failure rate"
          description: "Asset generation failure rate is above 10%"
